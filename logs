
----
LOGS
----

 * Setup tests for NR & R integrals [DONE2021/03/24]
 
 * Redesign and decouple codes [DONE2021/04/08]
    
 * Implementation of CTNS with TRS [DONE2021/05/16]
    - checked for kinds {rN,rNSz,cN,cNSz,cNK}
    - rewrite qtensor such that qt2/qt3/qt4 are just views

 * Parallelization: MPI [DONE2021/05/30]
    - cleanup (IO) 
    - setup testing mechanism? 
    - preparation: makefile -> mpi 
    - mpi version 
       - distribute AP & BQ, compxwf, Hmat [DONE2021/05/23]
       - opt: HDiag, HVec, Davidson, pRDM, rwfuns, twodot [DONE2021/05/28] 
       - load balance: adjust distribution
       - careful check serial/parallel version against previous 
         versions with different compilers

 * Benchmark performances: Fe2S2 [DONE2021/08/11]
    - different topologies: -> SVD-based decimation
       - problem: TRS-adapted SVD decimation is necessary in initialization [DONE2021/07/06] 
       - problem: decimation in sweep -> have to give up perturbative noise for CTNS! 
		   - decimation_row_nkr [DONE2021/07/09]
		   - decimation_row_kr [DONE2021/07/11]

 * Optimized parallel version [DONE2021/10/02]
    - OpenMP support [DONE2021/09/03]
	- Hx & decimation
	- Initialization of CTNS
    - Z2 symmetry: {rZ2,cZ2}
        - Checked by diagonalizing fock::Hmat
    - better data structure for qtensor & oper_dict [DONE2021/10/02]
        - problem: can bypass the 2GB limit in MPI_COUNT using native MPI support (later)

 * Optimized algorithm: symbolic algorithm
    - onedot algorithm:
    	- generation of onedot_Hx formulae
    	- implemenation of onedot_Hx contraction [DONE2022/01/16]
	  - adjoint of Hterm is treated in symbolic_onedot_Hx
	- implementation of Kramers version of Hx [DONE2022/01/18]
	  - different treatment of Hl,Hcr,{CS/SC,AP,BQ}
    - twodot algorithm:
    	- generation of twodot_Hx formulae [DONE2022/01/18]
    	- optimized formation of sigma vector [DONE2022/01/22]
          - contract_qt4_qt2 (without intermediate/reshaping)
    - renormalization algorithm:
	 - generation of formulae 
         - optimized renormalization [DONE2022/02/17]
    - generation of formula: 
        - onedot/twodot-ibond
        - renormalization [DONE2022/02/21]
    - profiling:
	- benchmark for small systems
	- minimize memory allocation / intermediates?
	- make sure the code works for Fe4S4 & Fe8S7 with small D 
	   - formulae correctly generated [DONE2022/02/27]

        ### TODOs ###
           - use input for schd & fname to control whether write *.txt	
	   - bool ifwrite = (fname == ""); 

    - optimization of onedot:
	- int1e only appears in oper_dot.h
        - remove explicit H() in qt_qt:
	  - revise qt3_qt2 without explicit H() 
          - revise qt4_qt2 without explicit H() [DONE2022/02/23]
        - preprocess: 
           - avoid memory allocation in sigma (onedot/twodot)
	   - avoid memset?
           - revise renormalization [DONE2022/02/27]

        ### TODOs ###
        - info only store offset or maps: [CRUCIAL PART!!!]
	   - auto& blk3 = qt3(br,bc,bm) - avoid computation!
        - avoid daxpy?

    - profile openmp version:
    - optimization of twodot: 
	- preallocation of workspace
	- contract_qt4_qt2_info 
    - kramers version:
	- how to avoid repeated K()?

 * Large-scale parallelization: push to the limit!
    - GPU for contractions?
    - memory bound for Hx & renorm

 * Applications:
    - Small system like C2+/O2? [checked against FCI results]
    - Fe2S2 [CAS(30e,20o)] - parallelized
    - SOC within this active space
    - G-tensor/GIAO for Ferric-Ferrous dimer [THIS WOULD BE GREAT!]
 
 * Twordms: enable Rel-CASSCF with interface to other codes 

--------------
KNOWN PROBLEMS
--------------

 1. thresh_proj & thresh_ortho sensitivity in SCI projection [theoretical/numerical problem?]

 2. to work with ctns, pRDM is removed which makes onedot opt prone to local minimum:
    implementing decimation for {|psi>, sum_k a_k|psi>, sum_l b_l|psi>} may help.

     /home/lx/lzd/focus_repo/FOCUS/examples/3_h6+_kr
     finput= results/rinput.dat
     fname[ref]= results/rctns.out
     nsweep= 2
     fname[cal]= ./tmp/rctns.out
     nsweep= 2
     eref= [-2.89565156 -2.74390766]  ecal= [-2.89503561 -2.74089796]  ediff= 0.0030720814731275076
     fail

 3. SVD-based decimation: total=2, full=8
   
     decimation for each symmetry sector:
     >br=0 qr=(4,0) rdim=2
     >br=1 qr=(5,-1) rdim=4
     >br=2 qr=(5,1) rdim=4
     >br=3 qr=(6,-2) rdim=2
     >br=4 qr=(6,0) rdim=8
      find matched qc =(0,0)
      SVD-based decimation: dim(l,r)=1,8
      sigs2[final]: 0.5 0.5
     >br=5 qr=(6,2) rdim=2
     >br=6 qr=(7,-1) rdim=4
     >br=7 qr=(7,1) rdim=4
     >br=8 qr=(8,0) rdim=2
     
     sorted renormalized states: total=2 dcut=2 thresh_sig2=1e-14
      i=0 qr=(6,0) 0-th sig2=0.5 accum=0.5
      i=1 qr=(6,0) 1-th sig2=0.5 accum=1
     select renormalized states per symmetry sector: nqr=9
      iqr=0 qr=(6,0) dim[full,kept]=8,2 wts=1 accum=1 deff=2
     decimation summary: 32->2 dwt=0 SvN=1
     
